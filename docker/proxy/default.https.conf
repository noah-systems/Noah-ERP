# Upstreams
upstream noah_api { server api:3000; }
upstream noah_web { server web:80; }

# HTTPS: front + API path-based
server {
  listen 443 ssl;
  http2 on;
  server_name erp.noahomni.com.br;

  ssl_certificate     /etc/letsencrypt/live/erp.noahomni.com.br/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/erp.noahomni.com.br/privkey.pem;

  # API
  location /api/ {
    proxy_pass http://noah_api/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Front
  location / {
    proxy_pass http://noah_web/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
