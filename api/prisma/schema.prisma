generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

enum LeadStage {
  NUTRICAO
  QUALIFICADO
  NAO_QUALIFICADO
}

enum Source {
  MANUAL
  GOOGLE_ADS
  META
  CAMPANHA
}

enum OpportunityStage {
  NEGOCIACAO
  APRESENTACAO
  PROPOSTA
  TRIAL
  VENC_TRIAL
  VENDAS
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String
  role         Role     @default(USER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  leads Lead[]        @relation("LeadOwner")
  opps  Opportunity[] @relation("OppOwner")
}

model Lead {
  id        String    @id @default(cuid())
  name      String
  email     String?
  phone     String?
  stage     LeadStage @default(NUTRICAO)
  source    Source    @default(MANUAL)
  ownerId   String?
  owner     User?     @relation("LeadOwner", fields: [ownerId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  opportunities Opportunity[]
}

model Opportunity {
  id        String           @id @default(cuid())
  title     String
  value     Float            @default(0)
  stage     OpportunityStage @default(NEGOCIACAO)
  leadId    String?
  lead      Lead?            @relation(fields: [leadId], references: [id])
  ownerId   String?
  owner     User?            @relation("OppOwner", fields: [ownerId], references: [id])
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}
